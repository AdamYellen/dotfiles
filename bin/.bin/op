#!/bin/bash

if [[ -n "$TMUX" ]]
then
   # update shell's LC_DESKTOP_HOST from tmux session
   eval $(tmux showenv -s LC_DESKTOP_HOST)
fi

if [[ -n "$SSH_CONNECTION" ]]
then
   if [[ -n "$LC_DESKTOP_HOST" ]]
   then
      if [[ "$LC_DESKTOP_HOST" != "$(hostname)" ]]
      then
         # not running locally and LC_DESKOP_HOST is defined, execute op over SSH to desktop host
         ssh $LC_DESKTOP_HOST /usr/local/bin/op $*
      else
         /usr/local/bin/op $*
      fi
   else
      # running over SSH but no LC_DESKTOP_HOST defined, try to run op on the connecting client host as a fallback
      ssh ${SSH_CLIENT%% *} /usr/local/bin/op $*
   fi
else
   /usr/local/bin/op $*
fi
