#!/bin/sh
# Install all dotfiles into the home directory

if [ -L "$0" ]
then
  SCRIPTSETUP="$(readlink "$0")"
else
  SCRIPTSETUP="$0"
fi

DOTFILESDIRREL=$(dirname $SCRIPTSETUP)
cd $DOTFILESDIRREL/..
DOTFILESDIR=$(pwd -P)

# setup SSH
rm -rf "$HOME/.ssh"
ln -sv "$DOTFILESDIR/ssh/" "$HOME/.ssh"

# setup GPG
rm -rf "$HOME/.gnupg"
ln -sv "$DOTFILESDIR/gnupg/" "$HOME/.gnupg"

# setup bin
rm -rf "$HOME/.bin"
ln -sv "$DOTFILESDIR/bin/" "$HOME/.bin"

# Use our minimal Brewfile
ln -sfv "$DOTFILESDIR/Brewfile.strap-deps" "$HOME/.Brewfile"

if [ -n "$CODESPACES" ]
then
  # Fix up Codespaces permissions
  chmod 700 /workspaces

  # Send notification that dotfiles setup has completed
  curl --silent \
    --form-string "token=$PUSHOVER_API_TOKEN" \
    --form-string "user=$PUSHOVER_USER_KEY" \
    --form-string "message=dotfiles script/setup complete for $CODESPACE_NAME!" \
    https://api.pushover.net/1/messages.json
fi
